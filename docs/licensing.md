# Apache-2.0 项目中的多媒体依赖选型与边界（非法律意见）

本文面向“播放器/播放内核”类项目：你希望**项目本体保持 Apache-2.0**，同时在不同平台上集成第三方多媒体库。

> 结论先行：  
> - **MIT/BSD/Apache/zlib/ISC 等宽松许可证**：通常可直接用。  
> - **LGPL**：通常可用，但要满足（重链接/替换库/提供许可与源码变更等）义务；移动端和“不可替换库”的分发形态要格外谨慎。  
> - **GPL**：如果你把 GPL 代码（库/插件）与产品一起分发并形成“一个整体作品”，通常会把分发物拉进 GPL；这与“项目仍是 Apache-2.0”目标往往冲突。  

## 1. 你想守住的“边界”

为了让仓库/核心代码继续以 Apache-2.0 分发，通常需要同时满足：

- **不要分发 GPL 依赖**（含：静态/动态链接的 GPL 库、打包在一起的 GPL 插件、把 GPL 代码直接拷进源码树等）。
- **对 LGPL 依赖按 LGPL 合规**：提供许可证文本与 notices；允许用户替换/重链接库（以及你对 LGPL 组件的修改源码）。
- **区分“源代码许可”与“编解码专利/商店条款”**：即便许可证兼容，某些编解码器（H.264/HEVC/AAC 等）仍可能涉及专利授权与商店政策。

## 2. 常见库的许可与可用性（面向 Apache-2.0 项目）

下面是“常见选择”的经验表（以你**实际使用/打包的构建产物**为准；同一项目可能有多种许可证/构建选项）。

### 解封装/解码/播放内核

- **FFmpeg**：`LGPL-2.1-or-later`（默认）/ 可选 `GPL-2.0-or-later`
  - 可用性：可用（选择 **LGPL 构建**），避免启用会触发 GPL 的配置与外部库。
  - 边界：你打包的二进制若包含 GPL 组件，则分发物会受 GPL 约束。
  - 参考：`https://ffmpeg.org/legal.html`

- **GStreamer**：核心通常 `LGPL-2.1-or-later`，插件集合许可证混合（LGPL/GPL/专有）
  - 可用性：可用（挑选 LGPL/许可兼容的插件集合）。
  - 边界：**不要分发 GPL 插件**（或确认你能接受整体 GPL 约束）。
  - 参考：`https://gstreamer.freedesktop.org/documentation/additional/design/licensing.html`

- **libVLC / VLC SDK**：通常 `LGPL-2.1-or-later`（但实际打包组件可能混合）
  - 可用性：一般可用（以 LGPL 组件方式集成）。
  - 边界：注意你实际随包带的 VLC 模块/插件/二进制的许可证；不要把 GPL 部件打进你的发行物。
  - 参考：`https://wiki.videolan.org/License/`

- **libmpv / mpv**：`GPL-2.0-or-later`
  - 可用性：若你坚持分发物保持非 GPL（如 Apache-2.0），通常不推荐把它作为随包依赖分发。
  - 参考：`https://github.com/mpv-player/mpv`

### 字幕/渲染/辅助库（通常更好兼容）

- **SDL2**：`zlib`（宽松）
  - 可用性：可用。
  - 参考：`https://github.com/libsdl-org/SDL`

- **Dear ImGui**：`MIT`
  - 可用性：可用。
  - 参考：`https://github.com/ocornut/imgui`

- **libass（ASS/SSA 字幕）**：常见为 `ISC`
  - 可用性：可用。
  - 参考：`https://github.com/libass/libass`

> 提醒：即便某个库本身是宽松许可证，它的“可选依赖/后端插件”仍可能引入 GPL/LGPL/专有条款；合规以最终打包物为准。

## 3. LGPL 的关键合规点（做播放器常踩坑）

不同 LGPL 版本与具体情形细节很多，这里给“工程可操作”的检查清单：

- **动态链接优先**：尽量把 LGPL 库作为可替换的动态库/共享对象分发。
- **允许重链接/替换**：用户能在合理条件下替换该 LGPL 库（或对静态链接场景提供可重链接对象文件/脚本）。
- **提供许可证与 notices**：在发行物中包含 LGPL 文本、版权声明、第三方声明。
- **提供你对 LGPL 组件的修改**：如果你改了 LGPL 组件本身，通常需要公开这些修改的源码（至少对接收者）。
- **移动端分发要谨慎**：iOS/某些商店分发形态可能让“用户替换库”在实践中很难满足；这不是“不能用”，但需要在架构与交付方式上提前设计（例如：尽量使用系统媒体框架，或用商业授权/替代库）。

## 4. 推荐的“边界设计”（保持核心 Apache-2.0）

如果你的目标是“核心代码 Apache-2.0，依赖尽量不拖入 GPL”，常见做法是：

- **核心播放抽象层 Apache-2.0**：定义 `core` API（打开媒体、轨道、时钟、渲染帧、字幕、缓冲策略）。
- **后端适配分层**：
  - `backend_ffmpeg`（LGPL 构建，动态链接）
  - `backend_gstreamer`（选择许可兼容插件）
  - `backend_avfoundation`（iOS/macOS 系统框架）
  - `backend_media3`（Android 系统/官方库）
- **插件/可选依赖不随包分发 GPL**：即便运行时“可加载”，只要你把 GPL 插件随安装包一起发出去，仍会触发分发义务。

## 5. 你可以在仓库里维护的文档/清单

建议至少维护：

- `THIRD_PARTY_NOTICES.md`：第三方依赖声明（见仓库模板）
- `docs/dependency-licensing.md`（本文）：选型原则与边界
- `LICENSES/`：按依赖收集许可证文本（可选但强烈推荐）

